--PTCG Energy Well,created by Lotus Assassin and edited by Pepper0ni
uiData={
 ["Darkness Energy"]="1030706086614178330/4BF95A690F7DA49C8FB1463B8E5F678703F7F45C/",
 ["Fairy Energy"]="1030706086614178507/2BB4792D5BF0D974368EFDE432484ABBCDB33AA0/",
 ["Fighting Energy"]="1030706086614178613/6211E80FA57B3462D3A78C725AE440B01D85F19B/",
 ["Grass Energy"]="1030706086614178225/936511C7DE88071C0EFD164A0208E9A4F0790121/",
 ["Fire Energy"]="1030706086614178732/FB70D14FE2A4CA823E53CA4B950D58C999D57E4A/",
 ["Lightning Energy"]="1030706086614178847/5043B10E02EF709244486A5E2F037DFA5ABB5211/",
 ["Metal Energy"]="1030706086614178951/97976CC1484C2344BF88BC4EDFCB5E4A74594199/",
 ["Psychic Energy"]="1030706086614179070/5936733CF9AA0FEC120262A82643501F5D98BC01/",
 ["Water Energy"]="1030706086614179173/A6197B243E1F67E908D76B837FC3EDCCCDD399EC/",
 ["Double Colorless Energy"]="1820017796661631080/0DF9A2A289E0A0EB41728D6E215B1C87D01B182F/",
 ["Rainbow Energy"]="1683750229115782770/686ED8BFB2DC9AB55651674D0DEDC386BBF83784/",
 ["Full Heal Energy"]="1820018084943436739/F11F0E246B75AF4CC47D6A5B6AEC8D81FC1D1B24/",
 ["Potion Energy"]="1820018084943436739/F11F0E246B75AF4CC47D6A5B6AEC8D81FC1D1B24/",
 ["Recycle Energy"]="1683750229115826732/66452D1F13201E093655BDD5703EDCDC3CF78B10/",
 ["Miracle Energy"]="1820018084943436418/776B312E63A52234CB59B4EB31B92D53390C4C60/",
 ["Boost Energy"]="1683750229116751942/799829CDDF5C8C3F9194A0ACE8BDE760DDD64E52/",
 ["Crystal Energy"]="1820017796661887284/5C9B8E0D6398A84B97303FED3F4E5FE2C37AC30F/",
 ["Warp Energy"]="1820018084943435313/D857842996C95F4625C98A32A071386155EBA85C/",
 ["Bounce Energy"]="1820018084943434875/8DA68E040714AEA804048F1C27B7E7B9B2430E54/",
 ["Cyclone Energy"]="1820018084943434445/4DFE8C43D7147091CD431C189E95EAE199AF1880/",
 ["Retro Energy"]="1820018084943433833/A6AA551493059C2512A083E6D2C4446F361308B5/",
 ["Multi Energy"]="1683750229116785523/0D8F3F0A4A3C5A852F4EE76C13287CB6E889D801/",
 ["Aqua Energy"]="1683750229116800888/6B359D728DB5A6C702B686690583F3B0EDF5A67C/",
 ["Magma Energy"]="1683750229116811962/F2E8224C083FD37C4A8A270521BD720D006EC070/",
 ["Double Rainbow Energy"]="1683750229116792942/8D79544B0E245E132E72B924697AB59412D37DC1/",
 ["Dark Metal Energy"]="1683750229116821380/6C0D1D7081A779E23345F683B3748190CE1DCDB3/",
 ["R Energy"]="1683750229116834552/C91FAAB0CBB8564181A26CFA7D6CC17E0B7616A2/",
 ["Heal Energy"]="1820018084943433296/51E37C2CD3BF320114B1B8277D9337C29B7F1431/",
 ["Scramble Energy"]="1683750229116840554/6B1943F496ADC3D2EAF5EF76331ADF5EF2B13AF7/",
 ["Holon Energy FF"]="1820018084943432699/860D25447A4301AFAAE2BC25E8EB5E566FE1F5F0/",
 ["Holon Energy GL"]="1820018084943432244/979B2B442313CB08CB17BA6565A320C5F58C4F6B/",
 ["Holon Energy WP"]="1820018084943431935/AD7A91996FA428D1D48C939D5821918A04163C07/",
 ["React Energy"]="1820018084943430289/6B8FD7D5F1F384F135494367377C571AF4A58353/",
 ["δ Rainbow Energy"]="1683750229116880377/488BD9E3EDC7BFE68A2D7CD5D2B32232523CF823/",
 ["Delta Rainbow Energy"]="1683750229116880377/488BD9E3EDC7BFE68A2D7CD5D2B32232523CF823/",
 ["Call Energy"]="1820018084943430547/50BF2638DB063353BB47EE4D8FCB06A3F11E279D/",
 ["Health Energy"]="1820018084943428811/6E7A440AD6888312FC7E55808E7D219BEDF07CE8/",
 ["Recover Energy"]="1820018084943429422/489E47B5DB605B3395FD4633215BECC94685C08C/",
 ["SP Energy"]="1820018084943428317/7FEDABCC7BFC5EFCA9BF81A3D7D2C77AB617F3A5/",
 ["Upper Energy"]="1683750229116903612/6BECDDB3683B440A3E3D77AFAC8C78604F54625A/",
 ["Rescue Energy"]="1820018084943427868/EDCFC1DDE6FE298690A9FE53EA59C2A63C16E090/",
 ["Prism Energy"]="1820018084943427440/E6543E66E425F950888E9D64A02FC3B4461218A0/",
 ["Blend Energy GFPD"]="1683750229116933253/F286FB09FC36EED642E1D91BAD311700FACBB475/",
 ["Blend Energy WLFM"]="1683750229116941512/A6ED59B52A325F95D363F365C122A906550A1824/",
 ["Blend Energy GrassFirePsychicDarkness"]="1683750229116933253/F286FB09FC36EED642E1D91BAD311700FACBB475/",
 ["Blend Energy WaterLightningFightingMetal"]="1683750229116941512/A6ED59B52A325F95D363F365C122A906550A1824/",
 ["Plasma Energy"]="1820018084943427034/711D73D60B2030DB48003377AC58974560CB2D45/",
 ["Herbal Energy"]="1820018084943426637/B5A317AF480B7F2FA123FD24B9C097BB1D51D315/",
 ["Strong Energy"]="1683750229116947485/336C858D594B0498AEF16B0D2FDE65BCF5870241/",
 ["Mystery Energy"]="1683750229116955059/4A22AD19E47F5B93FEE000762833B6205A95E797/",
 ["Shield Energy"]="1683750229116960949/137D74CFDB91C67811F91398003EA09D81CD0519/",
 ["Wonder Energy"]="1683750229116966580/4F4BD0774A7BD26F574E1DC6280227B4F9E99408/",
 ["Double Aqua Energy"]="1683750229116978776/7EF34BBCFA83F3DA74655E069835EF52DF7DF2DB/",
 ["Double Magma Energy"]="1683750229116985866/28FA5DC1CB995E830896C674F4E9BC9BBC483A5D/",
 ["Double Dragon Energy"]="1820018084943426225/9E4F250F04362862FF286EC4C2B6C2EEEA7EF4D7/",
 ["Dangerous Energy"]="1683750229116998557/6896CDB824F8C6F74ED1F227D8E704A96E95C162/",
 ["Flash Energy"]="1683750229116993163/55B69635CB85FCB80B3DCEE570A2DD426A80A2DA/",
 ["Burning Energy"]="1683750229117003446/7F3DBF50972D48976412DC79815AC559375D0E00/",
 ["Splash Energy"]="1683750229117008704/7AB4F32F72FE9EECF5E5BD37230CD23AF00AE2BB/",
 ["Counter Energy"]="1683750229117014248/CB6AE0D2D4C72F4839A6E08B20FA32F05193D563/",
 ["Super Boost Energy Prism Star"]="1683750229117024365/9CB004DB973EAA9A1AC6B35A710BA037293A8D42/",
 ["Super Boost Energy ◇"]="1683750229117024365/9CB004DB973EAA9A1AC6B35A710BA037293A8D42/",
 ["Unit Energy GFW"]="1683750229117033320/B1A186CB682D35601BD33D21AFFC97EE7BA19BFB/",
 ["Unit Energy LPM"]="1683750229117039136/7D50B86421DC86FE8203212C1ACB2F0777141650/",
 ["Unit Energy FDF"]="1683750229117047081/7C5938080148055DFFAF3B3A2D0A64355FB14AD4/",
 ["Unit Energy GrassFireWater"]="1683750229117033320/B1A186CB682D35601BD33D21AFFC97EE7BA19BFB/",
 ["Unit Energy LightningPsychicMetal"]="1683750229117039136/7D50B86421DC86FE8203212C1ACB2F0777141650/",
 ["Unit Energy FightingDarknessFairy"]="1683750229117047081/7C5938080148055DFFAF3B3A2D0A64355FB14AD4/",
 ["Beast Energy Prism Star"]="1683750229117055683/184DACC50436B5C4FEBCE74C179EB40B94308178/",
 ["Beast Energy ◇"]="1683750229117055683/184DACC50436B5C4FEBCE74C179EB40B94308178/",
 ["Memory Energy"]="1820018084943425579/A28022274A637B9B4A8F5B82D0C66415FF14F713/",
 ["Triple Acceleration Energy"]="1683750229117080917/0F6F691D058398D58958CAB9DA7552638C831C55/",
 ["Weakness Guard Energy"]="1683750229117086788/B09FBF126F6C02EDB8E69739D47B5F956BA9B3D4/",
 ["Draw Energy"]="1820018084943425000/C937D8AFC0DA2C1338B3AC752E5F6A742201897E/",
 ["Aurora Energy"]="1820018084943424283/2CDF043EF1206C47FEA80230F6EEAAFCBF6D8BF9/",
 ["Capture Energy"]="1820018084943423849/9C1916409FDD5DDC3BAB53E13513397919241ACA/",
 ["Horror P Energy"]="1683750229117093501/79EA1B98ABF6DE41FF2CA609F5A6BBC60A22C7BC/",
 ["Horror Psychic Energy"]="1683750229117093501/79EA1B98ABF6DE41FF2CA609F5A6BBC60A22C7BC/",
 ["Twin Energy"]="1820018084943422194/9F0F600166F9C56AF153A270E0C61DFEA955B0E5/",
 ["Speed L Energy"]="1820018084943422814/D52F3F7BAE9CF9F8943CD3206BC253698B945C20/",
 ["Speed Lightning Energy"]="1820018084943422814/D52F3F7BAE9CF9F8943CD3206BC253698B945C20/",
 ["Heat F Energy"]="1683750229117105385/C7FC75C02B6245AEB4CB1641C413EDAA5FBDF307/",
 ["Heat Fire Energy"]="1683750229117105385/C7FC75C02B6245AEB4CB1641C413EDAA5FBDF307/",
 ["Hiding D Energy"]="1820018084943420613/CF83050A652DE6CB0171081EB7CB780900F211B3/",
 ["Hiding Darkness Energy"]="1820018084943420613/CF83050A652DE6CB0171081EB7CB780900F211B3/",
 ["Powerful C Energy"]="1683750229117117009/32EFE048DBA0159F0FABF31C7BCE4C13D8BE227B/",
 ["Powerful Colorless Energy"]="1683750229117117009/32EFE048DBA0159F0FABF31C7BCE4C13D8BE227B/",
 ["Aromatic G Energy"]="1683750229117122908/C0F424D20D8904AC496A883E6FC7EE0949A57B63/",
 ["Aromatic Grass Energy"]="1683750229117122908/C0F424D20D8904AC496A883E6FC7EE0949A57B63/",
 ["Coating M Energy"]="1683750229117128061/BE5F41672A99E5B00FD19EF4EBC7CF7238D7EC86/",
 ["Coating Metal Energy"]="1683750229117128061/BE5F41672A99E5B00FD19EF4EBC7CF7238D7EC86/",
 ["Stone F Energy"]="1683750229117133449/096C1AF5718891C59F7676395282067889C47DA0/",
 ["Stone Fighting Energy"]="1683750229117133449/096C1AF5718891C59F7676395282067889C47DA0/",
 ["Wash W Energy"]="1683750229117138510/A4DE7F7D93D981A7BF889ADB1125240324C392CE/",
 ["Wash Water Energy"]="1683750229117138510/A4DE7F7D93D981A7BF889ADB1125240324C392CE/",
 ["Rapid Strike Energy"]="1820018084943420240/84CC4FEF17D2FF32BEEBC560A16C9F52BCC8E048/",
 ["Single Strike Energy"]="1820018084943415140/D11323070BA8C5267DEE21B1E36B0400D066442C/",
 ["Impact Energy"]="1820018084943414696/9EBFB2AABBE27CB96B2D1415F7D3B598F11302E7/",
 ["Lucky Energy"]="1820018084943414420/D2421665E5B777019ADD467AE8F108F906257197/",
 ["Spiral Energy"]="1820018084943414148/5426136AE1AAE405E733D46861998830FC43C54C/",
 ["Treasure Energy"]="1820018084943413769/7A8A3CC88AB2B3C814FB21E8D97A0E1D7F1F805D/",
 ["Fusion Strike Energy"]="1820018084943403185/F49147E443E10277B199180F438BD2C3E0A8D999/",
 ["Double Turbo Energy"]="1832406432240975354/ACE733FD6A52CFFA5EECDD5B7ABF4B31C246F757/",
 ["Holon's Voltorb"]="1832406432242107248/CEFCE05957D7FCA247A998948B95F1FADB323780/",
 ["Holon's Electrode"]="1832406432242108052/42B0415CFD9BE2B9B6881E040AE6F739C318BA37/",
 ["Holon's Magnemite"]="1832406432242107541/8C57ECA25216C9395D14394228E49D79DDADEB27/",
 ["Holon's Magneton"]="1832406432242107014/2674BE166018ABCF33712816473BA1F08F0FBF9E/",
 ["Holon's Castform"]="1832406432242107778/A0DBAC1898F157597D8E67C4EF7EB1821D825050/",
}
uiDataFiltered={
 ["Electrode"]="1826780185923088169/8F47AC221D9AFD36BEDABB9D9354B01BB0E4F2D6/",
 ["Charjabug"]="1826780185923088463/B2170F2F1A2EE7E8F54E3D01A44DAAEB471196B2/"
}
setFilter={
 ["Base #21"]=true,
 ["Base Set 2 #25"]=true,
 ["Evolutions #40"]=true,
 ["Unbroken Bonds #58"]=true,
}

function onLoad()
 Wait.condition(redrawUI,function()return self.type=="Bag" end)
end

function onObjectLeaveContainer(container)
 if container~=self then return end
 redrawUI()
end

function tryObjectEnter(obj)
 if obj.type=='Card'and isAnEnergy(obj.getName(),obj.getDescription())then
  Wait.frames(function()redrawUI()end,1)
  return true
 elseif obj.type=='Deck'then
  local takeObj=nil
  local remain=nil
  cards=obj.getObjects()
  for c=#cards,1,-1 do
   if isAnEnergy(cards[c].name,cards[c].description)then
    if remain then
     takeObj=remain
    else
     takeObj=obj.takeObject({index=c-1})
     remain=obj.remainder
    end
    self.putObject(takeObj)
   end
  end
  Wait.frames(function()redrawUI()end,1)
 end
 return false
end

function isAnEnergy(name,desc)
 if uiData[name] then return true end
 if uiDataFiltered[name]and setFilter[desc] then return true end
 return false
end

function countEnergyInBag()
 energy={}
 total=0
 objs=self.getObjects()
 for k,v in pairs(objs)do
  energy[v.name]=(energy[v.name]or 0)+1
  total=total+1
 end
 return total
end

function redrawUI()
 local total=countEnergyInBag()
--are we condensing the energy (ie showing 2x text)
 local condensed=total>4
 local assets={{name="All",url="http://cloud-3.steamusercontent.com/ugc/1820018084947602345/F2B4BCB031EAE09315CC5F4DB6369E7060DE2FD7/"}}
 local c={}

 for k,v in pairs(energy)do
  assets[#assets+1]={name=k,url="http://cloud-3.steamusercontent.com/ugc/"..(uiData[k] or uiDataFiltered[k])}
  if v>1 and condensed then
   c[#c+1]=getElementText(v)
   c[#c+1]=getElementImage(k)
  else
   for i=1,v do
    c[#c+1]=getElementImage(k)
   end
  end
 end

 self.UI.setCustomAssets(assets)
 Wait.time(function()setXml(c)end,0.15)
end

function setXml(c)
 self.UI.setXmlTable({{
  tag="Image",
  attributes={
   image="All",
   height=100,
   width=100,
   position="0 70 0",
   rotation="0 0 180",
   allowDragging=true,
   onClick="clickAll()",
   onEndDrag="dragAll()",
   }},
  {tag="HorizontalLayout",
  attributes={
   height=114,
   width=440,
   rotation="0 0 180",
   position="220 0 0",
   color="rgba(0,0,0,0.7)",
   childForceExpandWidth=false,
   padding="7 55 7"
  },
  children=c
 }})
end

function getElementText(num)
 return{tag="Text",
  attributes={
   resizeTextForBestFit=true,
   color="white",
   fontSize=60
  },
  value=num.."x",
 }
end

function getElementImage(name)
 return{tag="Image",
  attributes={
   image=name,
   preserveAspect=true,
   allowDragging=true,
   restrictDraggingToParentBounds=false,
   onClick="clickCard("..name..")",
   onEndDrag="dragCard("..name..")",
  }}
end

function clickCard(player,n)
 objs=self.getObjects()
 for k,v in pairs(objs)do
  if v~=nil and v.name==n then
   self.takeObject({guid=v.guid,position=self.positionToWorld({2.2,0,2.59}),rotation=self.getRotation()})
   break
  end
 end
end

function dragCard(player,n)
 objs=self.getObjects()
 for k,v in pairs(objs)do
  if v~=nil and v.name==n then
   playpos=player.getPointerPosition()
   playpos.y=playpos.y+1
   self.takeObject({guid=v.guid,position=playpos,rotation={0,player.getPointerRotation(),0},smooth=false})
   break
  end
 end
end

function clickAll(player)
 objs=self.getObjects()
 for k,v in pairs(objs)do
  if v~=nil then
   self.takeObject({guid=v.guid,position=self.positionToWorld({2.2,0,2.59}),rotation=self.getRotation()})
  end
 end
end

function dragAll(player)
 objs=self.getObjects()
 for k,v in pairs(objs)do
  if v~=nil then
   playpos=player.getPointerPosition()
   playpos.y=playpos.y+1
   self.takeObject({guid=v.guid,position=playpos,rotation={0,player.getPointerRotation(),0},smooth=false})
  end
 end
end
